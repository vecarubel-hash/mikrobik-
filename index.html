<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; position: fixed; font-family: sans-serif; }
        canvas { display: block; background: #f0f8ff; }
        /* ... –≤–∞—à —ñ—Å–Ω—É—é—á–∏–π CSS –¥–ª—è –¥–∂–æ–π—Å—Ç–∏–∫–∞ ... */
        #joy-bg { 
            position: absolute; bottom: 50px; left: 50px; 
            width: 100px; height: 100px; background: rgba(0,0,0,0.1); 
            border-radius: 50%; border: 2px solid rgba(0,0,0,0.2);
            touch-action: none; z-index: 10;
        }
        #joy-stick { 
            position: absolute; top: 25px; left: 25px; 
            width: 50px; height: 50px; background: #00c800; 
            border-radius: 50%; border: 3px solid white; pointer-events: none;
        }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    <div id="joy-bg"><div id="joy-stick"></div></div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const joyBg = document.getElementById('joy-bg');
        const joyStick = document.getElementById('joy-stick');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // –î–æ–¥–∞–Ω—ñ –Ω–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
        const player = { x: width/2, y: height/2, size: 20, vx: 0, vy: 0, energy: 100, score: 0, books: 0, friends: 0, viruses_avoided: 0 };
        const items = [];
        const foodColor = "#ffa500";
        const bookColor = "#00BFFF"; // –°–∏–Ω—ñ–π –¥–ª—è –∫–Ω–∏–≥
        const friendColor = "#FF69B4"; // –†–æ–∂–µ–≤–∏–π –¥–ª—è –¥—Ä—É–∑—ñ–≤
        const virusColor = "#FF4500"; // –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –≤—ñ—Ä—É—Å—ñ–≤

        // ... (–≤–µ—Å—å –∫–æ–¥ –¥–∂–æ–π—Å—Ç–∏–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–∏–º —Å–∞–º–∏–º) ...
        const maxDist = 40;
        function handleMove(e) {
            e.preventDefault();
            const touch = e.touches ? e.touches : e;
            const rect = joyBg.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            let dx = touch.clientX - centerX;
            let dy = touch.clientY - centerY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist > maxDist) { dx *= maxDist / dist; dy *= maxDist / dist; }
            joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
            player.vx = dx / 8; player.vy = dy / 8;
        }
        joyBg.addEventListener('touchstart', handleMove);
        joyBg.addEventListener('touchmove', handleMove);
        joyBg.addEventListener('touchend', () => { joyStick.style.transform = `translate(0px, 0px)`; player.vx = 0; player.vy = 0; });

        function spawn() {
            // –°–ø–∞–≤–Ω —ó–∂—ñ
            if (items.filter(item => item.type === 'food').length < 5) {
                items.push({ type: 'food', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 12, color: foodColor });
            }
            // –°–ø–∞–≤–Ω –∫–Ω–∏–≥
            if (items.filter(item => item.type === 'book').length < 3) {
                items.push({ type: 'book', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 10, color: bookColor });
            }
            // –°–ø–∞–≤–Ω –¥—Ä—É–∑—ñ–≤
            if (items.filter(item => item.type === 'friend').length < 2) {
                items.push({ type: 'friend', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 15, color: friendColor });
            }
             // –°–ø–∞–≤–Ω –≤—ñ—Ä—É—Å—ñ–≤ (–≤–æ—Ä–æ–≥—ñ–≤)
            if (items.filter(item => item.type === 'virus').length < 4) {
                items.push({ type: 'virus', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 25, color: virusColor, vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 0.5) * 2 });
            }
        }

        function update() {
            player.x += player.vx;
            player.y += player.vy;
            
            // ... (–æ–±–º–µ–∂–µ–Ω–Ω—è —Å—Ç—ñ–Ω –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —Ç–∏–º–∏ —Å–∞–º–∏–º–∏) ...
            if (player.x < player.size) player.x = player.size;
            if (player.x > width - player.size) player.x = width - player.size;
            if (player.y < player.size) player.y = player.size;
            if (player.y > height - player.size) player.y = height - player.size;

            player.energy -= 0.05;

            // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –≤—ñ—Ä—É—Å—ñ–≤ (—Ä—É—Ö —ñ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è)
            items.forEach(item => {
                if (item.type === 'virus') {
                    item.x += item.vx; item.y += item.vy;
                    if (item.x < item.size || item.x > width - item.size) item.vx *= -1;
                    if (item.y < item.size || item.y > height - item.size) item.vy *= -1;
                }
            });

            // –ó–±—ñ—Ä –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —Ç–∞ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è –∑ –≤—ñ—Ä—É—Å–∞–º–∏
            items.forEach((item, index) => {
                const d = Math.hypot(player.x - item.x, player.y - item.y);
                if (d < player.size + item.size) {
                    if (item.type === 'food') {
                        player.energy = Math.min(100, player.energy + 10);
                        player.score += 10;
                        items.splice(index, 1);
                    } else if (item.type === 'book') {
                        player.books += 1;
                        items.splice(index, 1);
                    } else if (item.type === 'friend') {
                        player.friends += 1;
                        items.splice(index, 1);
                    } else if (item.type === 'virus') {
                        // –ó—ñ—Ç–∫–Ω–µ–Ω–Ω—è –∑ –≤—ñ—Ä—É—Å–æ–º
                        player.energy -= 50; // –í—Ç—Ä–∞—Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó –ø—Ä–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ñ
                        player.viruses_avoided = 0; // –°–∫–∏–¥–∞—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ —É–Ω–∏–∫–Ω–µ–Ω–Ω—è
                        items.splice(index, 1);
                    }
                }
            });

            if (player.energy <= 0) {
                alert(`–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞! –†–∞—Ö—É–Ω–æ–∫: ${player.score}, –ö–Ω–∏–≥: ${player.books}, –î—Ä—É–∑—ñ–≤: ${player.friends}`);
                // –°–∫–∏–¥–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
                Object.assign(player, { x: width/2, y: height/2, energy: 100, score: 0, books: 0, friends: 0, viruses_avoided: 0 });
                items.length = 0; // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø—Ä–µ–¥–º–µ—Ç–∏
            }
            spawn();
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // –ú–∞–ª—é—î–º–æ –≤—Å—ñ –ø—Ä–µ–¥–º–µ—Ç–∏
            items.forEach(item => {
                ctx.fillStyle = item.color;
                ctx.beginPath();
                ctx.arc(item.x, item.y, item.size, 0, Math.PI*2);
                ctx.fill();
            });

            // ... (–∫–æ–¥ –º–∞–ª—é–≤–∞–Ω–Ω—è –º—ñ–∫—Ä–æ–±–∏–∫–∞ —Ç–∞ –æ—á–µ–π –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–∏–º —Å–∞–º–∏–º) ...
            const pulse = 1 + Math.sin(Date.now() * 0.01) * 0.05;
            ctx.fillStyle = `hsl(${player.energy * 1.2}, 70%, 45%)`;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size * pulse, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(player.x-7, player.y-5, 5, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(player.x+7, player.y-5, 5, 0, Math.PI*2); ctx.fill();

            // –û–Ω–æ–≤–ª–µ–Ω–∏–π –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–¥–æ–¥–∞–Ω–æ –∫–Ω–∏–≥–∏ —Ç–∞ –¥—Ä—É–∑—ñ)
            ctx.fillStyle = "#333";
            ctx.font = "bold 18px sans-serif";
            ctx.fillText(`‚ö° –ï–Ω–µ—Ä–≥—ñ—è: ${Math.max(0, Math.floor(player.energy))}%`, 20, 40);
            ctx.fillText(`‚≠ê –†–∞—Ö—É–Ω–æ–∫: ${player.score}`, 20, 70);
            ctx.fillText(`üìö –ö–Ω–∏–≥–∏: ${player.books}`, 20, 100);
            ctx.fillText(`ü§ù –î—Ä—É–∑—ñ: ${player.friends}`, 20, 130);


            update();
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
