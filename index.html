<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; position: fixed; font-family: sans-serif; }
        canvas { display: block; background: #f0f8ff; }
        #joy-bg { 
            position: absolute; bottom: 50px; left: 50px; 
            width: 100px; height: 100px; background: rgba(0,0,0,0.1); 
            border-radius: 50%; border: 2px solid rgba(0,0,0,0.2);
            touch-action: none; z-index: 10;
        }
        #joy-stick { 
            position: absolute; top: 25px; left: 25px; 
            width: 50px; height: 50px; background: #00c800; 
            border-radius: 50%; border: 3px solid white; pointer-events: none;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é, –∫–∞–∫ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ */
        .menu-button {
            position: absolute; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 300px; padding: 15px;
            text-align: center; color: white; font-weight: bold;
            border-radius: 10px; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            pointer-events: auto; /* –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ */
        }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∫–∞–∫ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ -->
    <div id="start-button" class="menu-button" style="background: #4CAF50; bottom: 50px;">–¢–û–†–ö–ù–ò–°–¨ –î–õ–Ø –°–¢–ê–†–¢–£</div>
    <div class="menu-button" style="background: #FF69B4; top: 50%; margin-top: -100px;">ü§ù –ó–∞–≤–æ–¥—å –¥—Ä—É–∑—ñ–≤</div>
    <div class="menu-button" style="background: #00BFFF; top: 50%; margin-top: -50px;">üìö –ß–∏—Ç–∞–π –∫–Ω–∏–≥–∏</div>
    <div class="menu-button" style="background: #FFA500; top: 50%; margin-top: 0px;">‚ö° –ó–±–∏—Ä–∞–π —ó–∂—É</div>
    <div class="menu-button" style="background: #FF4500; top: 50%; margin-top: 50px;">‚ö†Ô∏è –£–Ω–∏–∫–∞–π –≤—ñ—Ä—É—Å—ñ–≤</div>
    <div id="joy-bg"><div id="joy-stick"></div></div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const joyBg = document.getElementById('joy-bg');
        const joyStick = document.getElementById('joy-stick');
        const startButton = document.getElementById('start-button');
        const menuButtons = document.querySelectorAll('.menu-button');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const player = { x: width/2, y: height/2, size: 20, vx: 0, vy: 0, energy: 100, score: 0, books: 0, friends: 0 };
        const items = [];
        const foodColor = "#ffa500"; const bookColor = "#00BFFF"; const friendColor = "#FF69B4"; const virusColor = "#FF4500";

        const maxDist = 40;
        function handleMove(e) {
            e.preventDefault();
            const touch = e.touches ? e.touches : e;
            const rect = joyBg.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            let dx = touch.clientX - centerX; let dy = touch.clientY - centerY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist > maxDist) { dx *= maxDist / dist; dy *= maxDist / dist; }
            joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
            player.vx = dx / 8; player.vy = dy / 8;
        }
        joyBg.addEventListener('touchstart', handleMove);
        joyBg.addEventListener('touchmove', handleMove);
        joyBg.addEventListener('touchend', () => { joyStick.style.transform = `translate(0px, 0px)`; player.vx = 0; player.vy = 0; });


        let gameState = "menu"; // –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "menu"

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–∞
        startButton.addEventListener('click', () => {
            gameState = "playing";
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏ –¥–∂–æ–π—Å—Ç–∏–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
            menuButtons.forEach(button => button.style.display = 'none');
            joyBg.style.display = 'block'; 
        });
        
        // –°–∫—Ä—ã—Ç—å –¥–∂–æ–π—Å—Ç–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –º–µ–Ω—é
        joyBg.style.display = 'none';

        function spawn() {
            if (items.filter(item => item.type === 'food').length < 5) {
                items.push({ type: 'food', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 12, color: foodColor });
            }
            if (items.filter(item => item.type === 'book').length < 3) {
                items.push({ type: 'book', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 10, color: bookColor });
            }
            if (items.filter(item => item.type === 'friend').length < 2) {
                items.push({ type: 'friend', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 15, color: friendColor });
            }
            if (items.filter(item => item.type === 'virus').length < 4) {
                items.push({ type: 'virus', x: Math.random() * (width-40) + 20, y: Math.random() * (height-40) + 20, size: 25, color: virusColor, vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 0.5) * 2 });
            }
        }

        function update() {
            if (gameState !== "playing") return; // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –∏–≥—Ä—ã

            player.x += player.vx; player.y += player.vy;
            if (player.x < player.size) player.x = player.size;
            if (player.x > width - player.size) player.x = width - player.size;
            if (player.y < player.size) player.y = player.size;
            if (player.y > height - player.size) player.y = height - player.size;
            player.energy -= 0.05;

            items.forEach(item => {
                if (item.type === 'virus') {
                    item.x += item.vx; item.y += item.vy;
                    if (item.x < item.size || item.x > width - item.size) item.vx *= -1;
                    if (item.y < item.size || item.y > height - item.size) item.vy *= -1;
                }
            });

            items.forEach((item, index) => {
                const d = Math.hypot(player.x - item.x, player.y - item.y);
                if (d < player.size + item.size) {
                    if (item.type === 'food') { player.energy = Math.min(100, player.energy + 10); player.score += 10; items.splice(index, 1); } 
                    else if (item.type === 'book') { player.books += 1; items.splice(index, 1); } 
                    else if (item.type === 'friend') { player.friends += 1; items.splice(index, 1); } 
                    else if (item.type === 'virus') {
                        player.energy -= 50; 
                        items.splice(index, 1);
                    }
                }
            });

            if (player.energy <= 0) {
                alert(`–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞! –†–∞—Ö—É–Ω–æ–∫: ${player.score}, –ö–Ω–∏–≥: ${player.books}, –î—Ä—É–∑—ñ–≤: ${player.friends}`);
                Object.assign(player, { x: width/2, y: height/2, energy: 100, score: 0, books: 0, friends: 0 });
                items.length = 0; 
                gameState = "menu"; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é
                menuButtons.forEach(button => button.style.display = 'block'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
                joyBg.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –¥–∂–æ–π—Å—Ç–∏–∫
            }
            spawn();
        }

        function drawMenu() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "#333";
            ctx.font = "bold 30px sans-serif";
            ctx.textAlign = 'center';
            ctx.fillText("–ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê –∫–ª–∞—Å—É", width/2, height/2 - 180);

            // –†–∏—Å—É–µ–º –º–∏–∫—Ä–æ–±–∏–∫–∞ –≤ –º–µ–Ω—é
            ctx.fillStyle = "#00c800";
            ctx.beginPath();
            ctx.arc(width/2, height/2 - 100, player.size * 1.5, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(width/2 - 10, height/2 - 110, 5, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(width/2 + 10, height/2 - 110, 5, 0, Math.PI*2); ctx.fill();
            
             ctx.font = "bold 20px sans-serif";
             ctx.fillText("–¢–∏ —É—á–µ–Ω—å 4-–ê –∫–ª–∞—Å—É!", width/2, height/2 - 20);
        }

        function drawGame() {
            ctx.clearRect(0, 0, width, height);
            items.forEach(item => {
                ctx.fillStyle = item.color;
                ctx.beginPath();
                ctx.arc(item.x, item.y, item.size, 0, Math.PI*2);
                ctx.fill();
            });

            const pulse = 1 + Math.sin(Date.now() * 0.01) * 0.05;
            ctx.fillStyle = `hsl(${player.energy * 1.2}, 70%, 45%)`;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size * pulse, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(player.x-7, player.y-5, 5, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(player.x+7, player.y-5, 5, 0, Math.PI*2); ctx.fill();

            ctx.fillStyle = "#333";
            ctx.font = "bold 18px sans-serif";
            ctx.textAlign = 'left';
            ctx.fillText(`‚ö° –ï–Ω–µ—Ä–≥—ñ—è: ${Math.max(0, Math.floor(player.energy))}%`, 20, 40);
            ctx.fillText(`‚≠ê –†–∞—Ö—É–Ω–æ–∫: ${player.score}`, 20, 70);
            ctx.fillText(`üìö –ö–Ω–∏–≥–∏: ${player.books}`, 20, 100);
            ctx.fillText(`ü§ù –î—Ä—É–∑—ñ: ${player.friends}`, 20, 130);
        }

        function draw() {
            if (gameState === "menu") {
                drawMenu();
            } else if (gameState === "playing") {
                drawGame();
                update();
            }
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
