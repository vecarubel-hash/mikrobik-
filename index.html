<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #f0f8ff; 
            position: fixed; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            touch-action: none;
        }
        canvas { display: block; }
        
        #joy-bg { 
            position: absolute; bottom: 50px; left: 50px; 
            width: 100px; height: 100px; background: rgba(0,0,0,0.1); 
            border-radius: 50%; border: 2px solid rgba(0,0,0,0.2);
            touch-action: none; z-index: 100; display: none;
        }
        #joy-stick { 
            position: absolute; top: 25px; left: 25px; 
            width: 50px; height: 50px; background: #00c800; 
            border-radius: 50%; border: 3px solid white; pointer-events: none;
        }

        .menu-button {
            position: absolute; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 300px; padding: 12px;
            text-align: center; color: white; font-weight: bold;
            border-radius: 12px; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            z-index: 50;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    
    <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó -->
    <div class="menu-button info" style="background: #FF69B4; top: 20%;">ü§ù –ó–∞–≤–æ–¥—å –¥—Ä—É–∑—ñ–≤</div>
    <div class="menu-button info" style="background: #00BFFF; top: 30%;">üìö –ß–∏—Ç–∞–π –∫–Ω–∏–≥–∏</div>
    <div class="menu-button info" style="background: #FFA500; top: 40%;">‚ö° –ó–±–∏—Ä–∞–π —ó–∂—É</div>
    <div class="menu-button info" style="background: #FF4500; top: 50%;">‚ö†Ô∏è –£–Ω–∏–∫–∞–π –≤—ñ—Ä—É—Å—ñ–≤</div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç—É -->
    <div id="start-button" class="menu-button" style="background: #4CAF50; bottom: 80px; font-size: 22px; padding: 20px;">–ì–†–ê–¢–ò! ü¶†</div>

    <div id="joy-bg"><div id="joy-stick"></div></div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const joyBg = document.getElementById('joy-bg');
        const joyStick = document.getElementById('joy-stick');
        const startButton = document.getElementById('start-button');
        const infoButtons = document.querySelectorAll('.menu-button');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const player = { x: 0, y: 0, size: 22, vx: 0, vy: 0, energy: 100, score: 0, books: 0, friends: 0 };
        player.x = width/2; player.y = height/2;

        let items = [];
        const foodColor = "#ffa500", bookColor = "#00BFFF", friendColor = "#FF69B4", virusColor = "#FF4500";

        // –ö–ï–†–£–í–ê–ù–ù–Ø
        const maxDist = 40;
        let activeTouch = false;

        function handleMove(e) {
            if (!activeTouch && e.type !== 'mousemove') return;
            e.preventDefault();
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (—Ç–∞—á –∞–±–æ –º–∏—à–∫–∞)
            const input = e.touches ? e.touches[0] : e;
            const rect = joyBg.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            let dx = input.clientX - centerX;
            let dy = input.clientY - centerY;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist > maxDist) {
                dx *= maxDist / dist;
                dy *= maxDist / dist;
            }

            joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
            player.vx = dx / 7; // –®–≤–∏–¥–∫—ñ—Å—Ç—å
            player.vy = dy / 7;
        }

        joyBg.addEventListener('touchstart', (e) => { activeTouch = true; handleMove(e); });
        joyBg.addEventListener('touchmove', handleMove);
        window.addEventListener('touchend', () => { 
            activeTouch = false;
            joyStick.style.transform = `translate(0px, 0px)`; 
            player.vx = 0; player.vy = 0; 
        });

        // –°—Ç–∞–Ω –≥—Ä–∏
        let gameState = "menu";

        startButton.addEventListener('click', () => {
            gameState = "playing";
            infoButtons.forEach(b => b.style.display = 'none');
            joyBg.style.display = 'block';
            player.energy = 100;
        });

        function spawn() {
            if (items.filter(i => i.type === 'food').length < 5) 
                items.push({ type: 'food', x: Math.random() * (width-40)+20, y: Math.random() * (height-40)+20, size: 12, color: foodColor });
            if (items.filter(i => i.type === 'book').length < 3) 
                items.push({ type: 'book', x: Math.random() * (width-40)+20, y: Math.random() * (height-40)+20, size: 10, color: bookColor });
            if (items.filter(i => i.type === 'friend').length < 2) 
                items.push({ type: 'friend', x: Math.random() * (width-40)+20, y: Math.random() * (height-40)+20, size: 15, color: friendColor });
            if (items.filter(i => i.type === 'virus').length < 3) 
                items.push({ type: 'virus', x: Math.random() * (width-40)+20, y: Math.random() * (height-40)+20, size: 20, color: virusColor, vx: (Math.random()-0.5)*3, vy: (Math.random()-0.5)*3 });
        }

        function update() {
            if (gameState !== "playing") return;

            player.x += player.vx;
            player.y += player.vy;

            // –ö–æ—Ä–¥–æ–Ω–∏
            if (player.x < player.size) player.x = player.size;
            if (player.x > width - player.size) player.x = width - player.size;
            if (player.y < player.size) player.y = player.size;
            if (player.y > height - player.size) player.y = height - player.size;

            player.energy -= 0.06;

            items.forEach((item, index) => {
                if (item.type === 'virus') {
                    item.x += item.vx; item.y += item.vy;
                    if (item.x < item.size || item.x > width - item.size) item.vx *= -1;
                    if (item.y < item.size || item.y > height - item.size) item.vy *= -1;
                }

                const d = Math.hypot(player.x - item.x, player.y - item.y);
                if (d < player.size + item.size) {
                    if (item.type === 'food') { player.energy = Math.min(100, player.energy + 15); player.score += 10; }
                    else if (item.type === 'book') { player.books += 1; player.score += 20; }
                    else if (item.type === 'friend') { player.friends += 1; player.score += 30; }
                    else if (item.type === 'virus') { player.energy -= 30; }
                    items.splice(index, 1);
                }
            });

            if (player.energy <= 0) {
                alert(`–ì—Ä—É –∑–∞–∫—ñ–Ω—á–µ–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${player.score}`);
                gameState = "menu";
                items = [];
                player.x = width/2; player.y = height/2;
                player.score = 0; player.books = 0; player.friends = 0;
                infoButtons.forEach(b => b.style.display = 'block');
                joyBg.style.display = 'none';
            }
            spawn();
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            if (gameState === "menu") {
                ctx.fillStyle = "#333";
                ctx.font = "bold 28px sans-serif";
                ctx.textAlign = 'center';
                ctx.fillText("ü¶† –ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê", width/2, 100);
            } else {
                // –ú–∞–ª—é—î–º–æ –ø—Ä–µ–¥–º–µ—Ç–∏
                items.forEach(item => {
                    ctx.fillStyle = item.color;
                    ctx.beginPath();
                    ctx.arc(item.x, item.y, item.size, 0, Math.PI*2);
                    ctx.fill();
                    if(item.type === 'virus') { // –®–∏–ø–∏ –≤—ñ—Ä—É—Å—É
                        ctx.strokeStyle = item.color; ctx.lineWidth = 3;
                        for(let a=0; a<Math.PI*2; a+=Math.PI/4) {
                            ctx.moveTo(item.x, item.y);
                            ctx.lineTo(item.x+Math.cos(a)*30, item.y+Math.sin(a)*30);
                        }
                        ctx.stroke();
                    }
                });

                // –ú–∞–ª—é—î–º–æ –≥—Ä–∞–≤—Ü—è
                ctx.fillStyle = player.energy > 30 ? "#00c800" : "#ff4500";
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
                ctx.fill();
                // –û—á—ñ
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(player.x-7, player.y-5, 5, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(player.x+7, player.y-5, 5, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "black";
                ctx.beginPath(); ctx.arc(player.x-7, player.y-5, 2, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(player.x+7, player.y-5, 2, 0, Math.PI*2); ctx.fill();

                // HUD
                ctx.fillStyle = "#333";
                ctx.font = "bold 16px sans-serif";
                ctx.textAlign = 'left';
                ctx.fillText(`‚ö° –ï–Ω–µ—Ä–≥—ñ—è: ${Math.max(0, Math.floor(player.energy))}%`, 20, 40);
                ctx.fillText(`‚≠ê –†–∞—Ö—É–Ω–æ–∫: ${player.score}`, 20, 65);
                ctx.fillText(`üìö –ö–Ω–∏–≥–∏: ${player.books}`, 20, 90);
                ctx.fillText(`üë• –î—Ä—É–∑—ñ: ${player.friends}`, 20, 115);
            }

            update();
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
