<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ú—ñ–∫—Ä–æ–±–∏–∫ 4-–ê: –í–µ—Å–µ–ª–∞ –ü—Ä–∏–≥–æ–¥–∞</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #E0F7FA; 
            position: fixed; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            touch-action: none;
        }
        canvas { display: block; }
        
        .ui-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.9); z-index: 1000;
        }
        
        .title { font-size: 36px; color: #FF4500; text-shadow: 2px 2px #FFD700; margin-bottom: 20px; text-align: center; padding: 10px; }
        
        .btn-start {
            padding: 20px 50px; font-size: 28px; background: #4CAF50;
            color: white; border: none; border-radius: 25px;
            box-shadow: 0 8px #2E7D32; cursor: pointer;
        }

        #joy-bg { 
            position: absolute; bottom: 50px; left: 50px; 
            width: 120px; height: 120px; background: rgba(0,0,0,0.1); 
            border-radius: 50%; border: 3px solid rgba(0,0,0,0.2);
            touch-action: none; z-index: 100; display: none;
        }
        #joy-stick { 
            position: absolute; top: 35px; left: 35px; 
            width: 50px; height: 50px; background: #00E676; 
            border-radius: 50%; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .stats-top {
            position: absolute; top: 10px; left: 10px; background: white;
            padding: 8px 15px; border-radius: 15px; border: 2px solid #FF69B4;
            font-size: 18px; z-index: 50; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="menu" class="ui-screen">
        <div class="title">ü¶† –ú–Ü–ö–†–û–ë–ò–ö 4-–ê</div>
        <div style="font-size: 18px; margin-bottom: 20px; text-align: center; color: #333;">
            üçî –á–∂ —Å–º–∞–∫–æ–ª–∏–∫–∏ <br>
            üìö –ó–±–∏—Ä–∞–π –∑–Ω–∞–Ω–Ω—è <br>
            üê∂ –®—É–∫–∞–π –¥—Ä—É–∑—ñ–≤!
        </div>
        <button class="btn-start" onclick="startGame()">–ü–û–ß–ê–¢–ò –ì–†–£</button>
    </div>

    <div id="stats" class="stats-top" style="display: none;">
        ‚ö° –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy-val">100</span>% | ‚≠ê –ë–∞–ª–∏: <span id="score-val">0</span>
    </div>

    <canvas id="game"></canvas>
    <div id="joy-bg"><div id="joy-stick"></div></div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const joyBg = document.getElementById('joy-bg');
        const joyStick = document.getElementById('joy-stick');
        const menu = document.getElementById('menu');
        const stats = document.getElementById('stats');

        let width, height, gameState = "menu";
        
        const foodList = ['üç¨', 'üçî', 'üçï', 'üçé', 'üç¶'];
        const bookList = ['üìö', 'üìñ'];
        const friendList = ['üë¶', 'üëß', 'üê±', 'üê∂', 'üêº'];
        const virusList = ['üëæ', 'ü¶†'];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // –®–≤–∏–¥–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—è (vx, vy) —Ç–µ–ø–µ—Ä –¥—ñ–ª–∏—Ç—å—Å—è –Ω–∞ 12 –¥–ª—è –ø–æ–≤—ñ–ª—å–Ω–æ–≥–æ —Ä—É—Ö—É
        const player = { x: 0, y: 0, size: 35, vx: 0, vy: 0, energy: 100, score: 0 };
        let items = [];

        function startGame() {
            gameState = "playing";
            menu.style.display = "none";
            stats.style.display = "block";
            joyBg.style.display = "block";
            player.x = width / 2;
            player.y = height / 2;
            player.energy = 100;
            player.score = 0;
            items = [];
        }

        // –ö–ï–†–£–í–ê–ù–ù–Ø (–ó–º–µ–Ω—à–µ–Ω–∞ —á—É—Ç–ª–∏–≤—ñ—Å—Ç—å –¥–ª—è 4 –∫–ª–∞—Å—É)
        const maxDist = 45;
        function updateJoystick(e) {
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            const rect = joyBg.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            let dx = touch.clientX - cx;
            let dy = touch.clientY - cy;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist > maxDist) { dx *= maxDist / dist; dy *= maxDist / dist; }
            joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
            
            // –ü–û–í–Ü–õ–¨–ù–ò–ô –†–£–• (–¥—ñ–ª–∏–º–æ –Ω–∞ 12)
            player.vx = dx / 12;
            player.vy = dy / 12;
        }

        joyBg.addEventListener('touchstart', updateJoystick);
        joyBg.addEventListener('touchmove', updateJoystick);
        window.addEventListener('touchend', () => {
            joyStick.style.transform = `translate(0px, 0px)`;
            player.vx = 0; player.vy = 0;
        });

        function spawn() {
            if (items.length < 8) {
                const rand = Math.random();
                let category, list;
                if (rand < 0.5) { category = 'food'; list = foodList; }
                else if (rand < 0.75) { category = 'book'; list = bookList; }
                else if (rand < 0.9) { category = 'friend'; list = friendList; }
                else { category = 'virus'; list = virusList; }

                items.push({
                    type: category,
                    emoji: list[Math.floor(Math.random() * list.length)],
                    x: Math.random() * (width - 60) + 30,
                    y: Math.random() * (height - 60) + 30,
                    size: 28,
                    angle: Math.random() * Math.PI * 2,
                    speed: category === 'virus' ? 0.8 : 0 // –í—ñ—Ä—É—Å–∏ —Å—Ç–∞–ª–∏ –ø–æ–≤—ñ–ª—å–Ω–∏–º–∏
                });
            }
        }

        function update() {
            if (gameState !== "playing") return;

            player.x += player.vx;
            player.y += player.vy;
            
            // –ö–æ—Ä–¥–æ–Ω–∏ –µ–∫—Ä–∞–Ω—É
            if (player.x < player.size) player.x = player.size;
            if (player.x > width - player.size) player.x = width - player.size;
            if (player.y < player.size) player.y = player.size;
            if (player.y > height - player.size) player.y = height - player.size;

            // –ü–û–í–Ü–õ–¨–ù–ï –≤–∏—Ç—Ä–∞—á–∞–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó
            player.energy -= 0.025; 
            document.getElementById('energy-val').innerText = Math.max(0, Math.floor(player.energy));
            document.getElementById('score-val').innerText = player.score;

            items.forEach((item, index) => {
                if (item.type === 'virus') {
                    item.x += Math.cos(item.angle) * item.speed;
                    item.y += Math.sin(item.angle) * item.speed;
                    if (item.x < 10 || item.x > width - 10 || item.y < 10 || item.y > height - 10) item.angle += Math.PI;
                }

                const d = Math.hypot(player.x - item.x, player.y - item.y);
                if (d < player.size + 20) {
                    if (item.type === 'food') { player.energy = Math.min(100, player.energy + 15); player.score += 10; }
                    else if (item.type === 'book') { player.score += 50; }
                    else if (item.type === 'friend') { player.score += 100; player.energy = Math.min(100, player.energy + 10); }
                    else if (item.type === 'virus') { player.energy -= 25; }
                    items.splice(index, 1);
                }
            });

            if (player.energy <= 0) {
                gameState = "menu";
                menu.style.display = "flex";
                stats.style.display = "none";
                joyBg.style.display = "none";
                alert("–ï–Ω–µ—Ä–≥—ñ—è 0! –¢–≤—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: " + player.score);
            }
            spawn();
        }

        function draw() {
            // –°–≤—ñ—Ç–ª–∏–π —Ñ–æ–Ω
            ctx.fillStyle = "#E1F5FE";
            ctx.fillRect(0, 0, width, height);

            if (gameState === "playing") {
                // –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ï–º–æ–¥–∑—ñ –¥–ª—è iPhone
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.font = "40px 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif";

                items.forEach(item => {
                    const wobble = Math.sin(Date.now() * 0.003 + item.x) * 4;
                    ctx.fillText(item.emoji, item.x, item.y + wobble);
                });

                // –ú–∞–ª—é—î–º–æ –ú—ñ–∫—Ä–æ–±–∏–∫–∞
                const time = Date.now() * 0.005;
                const pSize = player.size + Math.sin(time) * 2;
                
                ctx.fillStyle = "#4CAF50";
                ctx.beginPath();
                ctx.arc(player.x, player.y, pSize, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = "white"; ctx.lineWidth = 4; ctx.stroke();

                // –û—á—ñ –º—ñ–∫—Ä–æ–±–∏–∫–∞
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(player.x-12, player.y-8, 9, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(player.x+12, player.y-8, 9, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "black";
                ctx.beginPath(); ctx.arc(player.x-12 + (player.vx*2), player.y-8 + (player.vy*2), 4, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(player.x+12 + (player.vx*2), player.y-8 + (player.vy*2), 4, 0, Math.PI*2); ctx.fill();
                
                // –†–æ—Ç
                ctx.strokeStyle = "black"; ctx.lineWidth = 3; ctx.beginPath();
                ctx.arc(player.x, player.y + 10, 8, 0.2, Math.PI-0.2, false); ctx.stroke();
            }

            update();
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
